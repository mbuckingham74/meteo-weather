#!/bin/sh
# Pre-commit hook: Run critical regression tests
# Prevents "Old Location" bug from being re-introduced

echo "üîç Running critical regression tests..."

# Check if geolocationService.js was modified
if git diff --cached --name-only | grep -q "geolocationService.js"; then
  echo "‚ö†Ô∏è  geolocationService.js modified - running regression tests..."

  # Run regression tests
  cd frontend
  npm run test -- geolocationService.regression.test.js --run

  if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå CRITICAL REGRESSION DETECTED!"
    echo ""
    echo "The 'Old Location' bug has been re-introduced in geolocationService.js"
    echo "Please fix the issues before committing."
    echo ""
    echo "Common fix:"
    echo "  WRONG: address = 'Your Location'"
    echo "  RIGHT: address = \`\${latitude}, \${longitude}\`"
    echo ""
    echo "See: docs/troubleshooting/OLD_LOCATION_BUG_FIX.md"
    echo ""
    exit 1
  fi

  echo "‚úÖ Regression tests passed"
  cd ..
fi

echo "‚úÖ Pre-commit checks complete"
